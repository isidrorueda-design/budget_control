<div class="contextual">
  <%= link_to 'Nuevo Contratista', new_bc_contractor_path(project_id: @project), class: 'icon icon-add' if User.current.allowed_to?(:manage_budget_control, @project) %>
  <%= link_to 'Importar', '#', class: 'icon icon-upload', onclick: "$('#import-dialog').dialog('open'); return false;" if User.current.allowed_to?(:manage_budget_control, @project) %>
  <%= link_to 'Exportar', export_bc_contractors_path(project_id: @project, format: :xlsx), class: 'icon icon-download' %>
</div>

<h2>Contratistas</h2>

<div class="autoscroll">
  <table class="list">
    <thead>
      <tr>
        <th style="text-align: left;">Nombre</th>
        <th style="text-align: left;">Responsable</th>
        <th style="text-align: left;">Teléfono</th>
        <th style="text-align: left;">Email</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @contractors.each do |contractor| %>
        <tr class="entry <%= cycle('odd', 'even') %>">
          <td style="text-align: left;"><%= contractor.name %></td>
          <td style="text-align: left;"><%= contractor.manager %></td>
          <td style="text-align: left;"><%= contractor.phone %></td>
          <td style="text-align: left;"><%= contractor.email %></td>
          <td class="buttons">
            <%= link_to 'Editar', edit_bc_contractor_path(contractor, project_id: @project), class: 'icon icon-edit' if User.current.allowed_to?(:manage_budget_control, @project) %>
            <%= link_to 'Eliminar', bc_contractor_path(contractor, project_id: @project), method: :delete, data: { confirm: '¿Estás seguro?' }, class: 'icon icon-del' if User.current.allowed_to?(:manage_budget_control, @project) %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<% if User.current.allowed_to?(:manage_budget_control, @project) %>
<div id="import-dialog" title="Importar Contratistas" style="display:none;">
  <%= form_tag(import_bc_contractors_path(project_id: @project), multipart: true) do %>
    <p>
      <%= label_tag 'file', 'Selecciona un archivo XLSX' %><br>
      <%= file_field_tag 'file', accept: '.xlsx' %>
    </p>
    <p>El archivo debe contener las columnas: <strong>Nombre, Responsable, Teléfono, Email</strong>.</p>
    <%= submit_tag 'Importar', class: 'button-positive' %>
  <% end %>
</div>
<script>$(function() { $("#import-dialog").dialog({ autoOpen: false, modal: true, width: 500 }); });</script>
<% end %>